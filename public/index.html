<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8">
<title>Simulador KYC – Perfiles y Evaluación</title>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<style>
  :root{--bg:#0f172a;--card:#0b1220;--ink:#e5e7eb;--muted:#94a3b8;--ring:#243047;--pri:#10b981;--acc:#3b82f6;--warn:#f59e0b;--bad:#ef4444}
  html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:linear-gradient(135deg,#0f172a,#111827);color:var(--ink)}
  .container{max-width:1100px;margin:auto;padding:20px}
  h1{font-size:clamp(22px,3.5vw,38px);margin:0 0 6px}
  .muted{color:var(--muted)}
  .card{background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.03));border:1px solid var(--ring);border-radius:16px;padding:16px 18px;box-shadow:0 8px 24px rgba(0,0,0,.25);margin:12px 0}
  label{display:block;margin:10px 0 6px;color:var(--muted);font-size:14px}
  input,select,textarea{width:100%;background:#0b1220;color:var(--ink);border:1px solid #223;border-radius:10px;padding:10px 12px;outline:none}
  input:focus,select:focus,textarea:focus{border-color:var(--acc);box-shadow:0 0 0 3px rgba(59,130,246,.25)}
  .grid{display:grid;gap:12px}
  @media(min-width:880px){.grid-2{grid-template-columns:1fr 1fr}}
  .row3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:10px}
  .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
  button,.btn{background:linear-gradient(135deg,#0ea5e9,#2563eb);color:#fff;border:none;padding:12px 16px;border-radius:12px;font-weight:700;cursor:pointer}
  .btn-ghost{background:transparent;border:1px solid var(--ring)}
  .btn-ok{background:linear-gradient(135deg,#10b981,#059669)}
  .btn-warn{background:linear-gradient(135deg,#f59e0b,#d97706)}
  .btn-bad{background:linear-gradient(135deg,#ef4444,#b91c1c)}
  .ficha{display:grid;grid-template-columns:120px 1fr;gap:14px}
  .foto{width:120px;height:160px;border:2px solid #9aa;box-shadow:inset 0 0 0 6px #222;border-radius:6px;overflow:hidden}
  .foto img{width:100%;height:100%;object-fit:cover}
  .pill{display:inline-block;padding:4px 10px;border:1px solid var(--ring);border-radius:999px;color:var(--muted);font-size:12px}
  .meter{height:10px;background:#0b1220;border:1px solid var(--ring);border-radius:8px;overflow:hidden}
  .meter i{display:block;height:100%;width:0;background:linear-gradient(90deg,#22c55e,#f59e0b,#ef4444)}
  .small{font-size:12px;color:var(--muted)}
  table{width:100%;border-collapse:collapse;border:1px solid var(--ring);border-radius:8px;overflow:hidden}
  th,td{padding:8px 10px;border-bottom:1px solid var(--ring);text-align:left}
  th{background:#0b1220}
  .right{text-align:right}
  @media print{.no-print{display:none!important}; body{background:#fff;color:#000} .card{border:1px solid #777;box-shadow:none}}
</style>
</head>
<body>
<div class="container">
  <h1>Simulador KYC – 12 Perfiles</h1>
  <div class="muted">El sistema registra leads, selecciona 3 perfiles al azar, califica y permite imprimir el reporte.</div>

  <!-- Registro de lead -->
  <div class="card" id="leadCard">
    <span class="pill">Registro</span>
    <h2>Datos de acceso (Lead)</h2>
    <div class="grid grid-2">
      <div>
        <label>Nombre completo</label>
        <input id="leadNombre" placeholder="Tu nombre y apellidos" />
      </div>
      <div>
        <label>Correo</label>
        <input id="leadCorreo" type="email" placeholder="tucorreo@dominio.com" />
      </div>
      <div>
        <label>Celular</label>
        <input id="leadCel" type="tel" placeholder="+52 55 0000 0000" />
      </div>
      <div>
        <label>Consentimiento</label>
        <select id="leadConsent">
          <option value="Sí">Sí, acepto contacto para información del curso</option>
          <option value="No">No, solo quiero probar el simulador</option>
        </select>
      </div>
    </div>
    <div class="btns no-print">
      <button class="btn-ok" id="btnIniciar">Iniciar simulación</button>
      <button class="btn-ghost" id="btnLeadsCSV">Descargar leads CSV</button>
    </div>
    <div class="small">Se guarda en tu navegador; puedes descargar CSV y subirlo a tu CRM/Hotmart.</div>
  </div>

  <!-- Contenedor de perfiles en evaluación -->
  <div id="evalWrap" style="display:none">
    <div class="card">
      <span class="pill">Evaluación</span>
      <h2 id="tituloEval">Perfiles a evaluar (3 de 12, seleccionados al azar)</h2>
      <div class="small">Asigna puntaje de riesgo 0–100 por factor y escribe una justificación (≥ 50 caracteres). El sistema propone escalas base.</div>
    </div>

    <div id="perfilesContainer"></div>

    <div class="card">
      <span class="pill">Resultado</span>
      <h2>Calificación final</h2>
      <table>
        <thead><tr><th>Perfil</th><th class="right">Puntaje Global (0–100)</th><th>Nivel</th></tr></thead>
        <tbody id="tablaResultados"></tbody>
        <tfoot>
          <tr><th>Promedio final</th><th class="right" id="promFinal">0</th><th id="nivelFinal">—</th></tr>
        </tfoot>
      </table>
      <div class="btns no-print">
        <button class="btn-warn" id="btnCalcular">Calcular</button>
        <button class="btn" id="btnImprimir">Imprimir / PDF</button>
        <button class="btn-ghost" id="btnExportJSON">Exportar JSON</button>
        <a id="dlJSON" class="btn-ghost" style="display:none" download="reporte_simulacion.json">Descargar JSON</a>
      </div>
    </div>
  </div>

  <div class="small" style="text-align:center;margin:16px 0">
    Perfiles extraídos del documento proporcionado por el cliente (uso didáctico). 
  </div>
</div>

<script>
/* =======================
   Datos de los 12 perfiles
   Las fotos deben estar en ../imagenes con estos nombres exactos.
   Fuente de descripciones: documento anexo del cliente.
======================= */
const PROFILES = [
  {id:"hans", foto:"../imagenes/Hans_Muller.jpg", nombre:"Hans Müller", direccion:"Av. Reforma 123, CDMX", nacionalidad:"Alemana", ocupacion:"Importador de maquinaria",
   bullets:[
    "Transferencia internacional de $500,000 USD desde Suiza, operaciones comerciales regulares",
    "Volumen: $500,000; Frecuencia: mensual; Manejo de efectivo: bajo",
    "Transferencias desde cuentas en Suiza",
    "Pariente en Alemania, Exministro de Finanzas (PEP). Perfil complejo por conexiones internacionales"
   ]},
  {id:"juana", foto:"../imagenes/Juana_perez.jpg", nombre:"Juana Pérez Luna", direccion:"Calle Tulipanes 45, Toluca", nacionalidad:"Mexicana", ocupacion:"Ama de casa",
   bullets:[
    "Sin actividad económica registrada; operaciones menores por transferencias familiares",
    "Volumen: $10,000 mensuales; Manejo de efectivo: alto",
    "Transferencias familiares desde Estados Unidos",
    "Esposa de empresario involucrado en escándalo de corrupción"
   ]},
  {id:"emilio", foto:"../imagenes/Emilio_torres.jpg", nombre:"Emilio Torres Hernández", direccion:"Paseo del Sol 98, Guadalajara", nacionalidad:"Mexicana", ocupacion:"Influencer digital",
   bullets:[
    "Depósitos en efectivo por $50,000/mes; ingresos de plataformas digitales",
    "Frecuencia: semanal; Manejo de efectivo: alto",
    "Depósitos de seguidores sin justificación clara",
    "Actividad de alto riesgo por no justificar origen de ingresos"
   ]},
  {id:"pedro", foto:"../imagenes/Pedro_hdez.jpg", nombre:"Pedro Hernández Juárez", direccion:"Camino Ejidal s/n, Oaxaca", nacionalidad:"Mexicana", ocupacion:"Agricultor",
   bullets:[
    "Solicita microcrédito; operaciones en efectivo por falta de acceso bancario",
    "Volumen bajo; Manejo de efectivo alto",
    "No posee RFC ni CURP; transacciones en efectivo",
    "Ingresos no fácilmente verificables"
   ]},
  {id:"monica", foto:"../imagenes/Monica_gomez.jpg", nombre:"Mónica Gómez García", direccion:"Av. Patriotismo 750, CDMX", nacionalidad:"Mexicana", ocupacion:"Abogada corporativa",
   bullets:[
    "Solicita banca patrimonial para gestionar su patrimonio",
    "Frecuencia: mensual; Volumen: $120,000; Manejo de efectivo: bajo",
    "Depósitos de clientes corporativos",
    "Familiares con procesos legales (sin PEPs). Riesgo controlado"
   ]},
  {id:"luis", foto:"../imagenes/Luis_ramos.jpg", nombre:"Luis Ramos Corona", direccion:"Calle Comercio 12, Iztapalapa", nacionalidad:"Mexicana", ocupacion:"Comerciante informal",
   bullets:[
    "Ventas en tianguis; depósitos menores en cuenta bancaria",
    "Frecuencia: diaria; Volumen bajo; Manejo de efectivo alto",
    "Depósitos en efectivo de $5,000 diarios",
    "Origen de fondos incierto por alta informalidad"
   ]},
  {id:"jose", foto:"../imagenes/Jose_rios.jpg", nombre:"José Ríos Díaz", direccion:"Priv. Reforma 21, Morelia", nacionalidad:"Mexicana", ocupacion:"Exfuncionario público",
   bullets:[
    "Movimientos internacionales; inversión en fondos privados",
    "Volumen alto; Manejo de efectivo bajo",
    "Transferencias desde cuentas en paraísos fiscales",
    "Conexiones con recursos públicos; posible riesgo de LA/FT"
   ]},
  {id:"ana", foto:"../imagenes/Ana_robles.jpg", nombre:"Ana Robles Moreno", direccion:"Av. Salud 321, Monterrey", nacionalidad:"Mexicana", ocupacion:"Médico especialista",
   bullets:[
    "Solicita crédito automotriz; ingresos por honorarios y nómina",
    "Frecuencia: mensual; Volumen: $100,000; Manejo de efectivo: bajo",
    "Ingresos de consultorio y hospitales privados",
    "Posible irregularidad en pagos en efectivo no acordes a perfil"
   ]},
  {id:"yu", foto:"../imagenes/Yu_chen.jpg", nombre:"Yu Chen", direccion:"Residencial UNAM, CDMX", nacionalidad:"China", ocupacion:"Estudiante",
   bullets:[
    "Recibe beca del gobierno chino; mantiene cuenta para transferencias",
    "Frecuencia: mensual; Volumen: $10,000; Manejo de efectivo: bajo",
    "Transferencias mensuales gubernamentales",
    "Perfil de bajo riesgo por fondos institucionalizados; sin PEPs"
   ]},
  {id:"daniel", foto:"../imagenes/Daniel_cruz.jpg", nombre:"Daniel Cruz Gonzáles", direccion:"Calle Startups 404, Querétaro", nacionalidad:"Mexicana", ocupacion:"Desarrollador Fintech",
   bullets:[
    "Solicita cuenta para app financiera; sin RFC",
    "Frecuencia: mensual; Volumen bajo; Manejo de efectivo bajo",
    "Inversiones en cripto y tecnología emergente",
    "Empresa no registrada ante SAT; sin estructura legal aún"
   ]},
  {id:"antonio", foto:"../imagenes/Antonio_rivera.jpg", nombre:"Antonio Rivera Marín", direccion:"Madero 200, Mexicali", nacionalidad:"Mexicana", ocupacion:"Pensionado",
   bullets:[
    "Recibe pensión mensual; operaciones por $10,000",
    "Frecuencia: mensual; Manejo de efectivo bajo",
    "Pensión de gobierno (ingreso estable y verificable)",
    "Caso de bajo riesgo; sin PEPs"
   ]},
  {id:"laura", foto:"../imagenes/Laura_mendez.jpg", nombre:"Laura Méndez", direccion:"Guerrero 900, Monterrey", nacionalidad:"Mexicana", ocupacion:"Modelo de TV",
   bullets:[
    "Pagos mensuales por contrato de exclusividad (~$50,000)",
    "Frecuencia mensual; Manejo de efectivo bajo",
    "Alta visibilidad en medios",
    "Pagos por contrato y eventos; sin PEPs"
   ]}
];

/* =======================
   Utilidades y constantes
======================= */
const $=id=>document.getElementById(id);
const choose3 = arr => arr.slice().sort(()=>Math.random()-0.5).slice(0,3);
const NIVEL = s => s<30?["Bajo","#22c55e"]:s<55?["Medio","#f59e0b"]:s<75?["Alto","#fb923c"]:["Crítico","#ef4444"];

// Ponderaciones iguales por simplicidad en este simulador (puedes ajustarlas)
const W = {actividad:.2, trans:.25, inst:.15, geo:.15, pep:.15, delitos:.10};

/* =======================
   Registro de leads
======================= */
function saveLead(){
  const lead = {
    nombre: $('leadNombre').value.trim(),
    correo: $('leadCorreo').value.trim(),
    celular: $('leadCel').value.trim(),
    consentimiento: $('leadConsent').value,
    ts: new Date().toISOString()
  };
  if(!lead.nombre || !lead.correo || !lead.celular){
    alert("Completa nombre, correo y celular.");
    return null;
  }
  const key="kyc_leads";
  const arr = JSON.parse(localStorage.getItem(key)||"[]");
  arr.push(lead);
  localStorage.setItem(key, JSON.stringify(arr));
  return lead;
}

$('btnLeadsCSV').addEventListener('click',()=>{
  const arr = JSON.parse(localStorage.getItem("kyc_leads")||"[]");
  const header = ["nombre","correo","celular","consentimiento","ts"];
  const rows = [header.join(",")].concat(arr.map(o=>header.map(h=>`"${(o[h]||"").replace(/"/g,'""')}"`).join(",")));
  const blob = new Blob([rows.join("\n")], {type:"text/csv"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a'); a.href=url; a.download="leads_kyc.csv"; a.click();
});

/* =======================
   Render de evaluación
======================= */
function perfilCard(p, idx){
  const id = `pf${idx}`;
  return `
  <div class="card" id="${id}">
    <div class="ficha">
      <div class="foto"><img src="${p.foto}" alt="Foto de ${p.nombre}"></div>
      <div>
        <span class="pill">Perfil</span>
        <h3 style="margin:6px 0 6px">${p.nombre}</h3>
        <div class="small">${p.ocupacion} • ${p.nacionalidad} • ${p.direccion}</div>
        <ul style="margin:8px 0 0 18px">
          ${p.bullets.map(b=>`<li>${b}</li>`).join("")}
        </ul>
      </div>
    </div>

    <div class="grid grid-2" style="margin-top:12px">
      <div>
        <label>Actividad (0–100)</label><input type="number" min="0" max="100" id="${id}_actividad" value="50">
        <label>Transaccionalidad (0–100)</label><input type="number" min="0" max="100" id="${id}_trans" value="50">
        <label>Instrumento monetario (0–100)</label><input type="number" min="0" max="100" id="${id}_inst" value="50">
      </div>
      <div>
        <label>Geografía (0–100)</label><input type="number" min="0" max="100" id="${id}_geo" value="50">
        <label>Relación con PEP (0–100)</label><input type="number" min="0" max="100" id="${id}_pep" value="50">
        <label>Delitos/Incumplimientos (0–100)</label><input type="number" min="0" max="100" id="${id}_del" value="50">
      </div>
    </div>
    <label>Justificación (≥ 50 caracteres)</label>
    <textarea id="${id}_just" placeholder="Explica por qué asignaste estos puntajes. Considera indicios, documentación y señales."></textarea>

    <div class="grid grid-2" style="margin-top:10px">
      <div class="meter"><i id="${id}_bar" style="width:0%"></i></div>
      <div style="text-align:right"><strong id="${id}_score">0</strong> / <span id="${id}_nivel">—</span></div>
    </div>
  </div>`;
}

let seleccion = [];
function renderEvaluacion(){
  const cont = $('perfilesContainer');
  cont.innerHTML = seleccion.map((p,i)=>perfilCard(p,i)).join("");
}

/* =======================
   Cálculo y reporte
======================= */
function calcPerfil(i){
  const id = `pf${i}`;
  const g = n=>Math.max(0, Math.min(100, Number($(id+"_"+n).value||0)));
  const just = $(id+"_just").value.trim();
  const okJust = just.length>=50;
  if(!okJust){ $(id+"_just").style.borderColor = "#f59e0b"; }

  const s = {
    actividad:g("actividad"), trans:g("trans"), inst:g("inst"),
    geo:g("geo"), pep:g("pep"), delitos:g("del")
  };
  const global = s.actividad*W.actividad + s.trans*W.trans + s.inst*W.inst + s.geo*W.geo + s.pep*W.pep + s.delitos*W.delitos;
  const [nivel,color]=NIVEL(global);
  $(id+"_bar").style.width = Math.round(global)+"%";
  $(id+"_score").textContent = Math.round(global);
  $(id+"_nivel").textContent = nivel;
  return {score:Math.round(global), nivel, color, justificacion:just, factores:s, okJust};
}

function calcularTodo(){
  const resultados = seleccion.map((_,i)=>calcPerfil(i));
  const tbody = $('tablaResultados');
  tbody.innerHTML = seleccion.map((p,i)=>`<tr><td>${p.nombre}</td><td class="right">${resultados[i].score}</td><td>${resultados[i].nivel}</td></tr>`).join("");
  const prom = Math.round(resultados.reduce((a,b)=>a+b.score,0)/resultados.length);
  const [nivel,color]=NIVEL(prom);
  $('promFinal').textContent = prom;
  $('nivelFinal').textContent = nivel;
  const allJust = resultados.every(r=>r.okJust);
  if(!allJust){ alert("Hay justificaciones con menos de 50 caracteres. Corrige para un expediente completo."); }
  return {prom, nivel, resultados};
}

/* =======================
   Export / Print
======================= */
$('btnImprimir').addEventListener('click',()=>{ calcularTodo(); window.print(); });

$('btnExportJSON').addEventListener('click',()=>{
  const lead = JSON.parse(localStorage.getItem("last_lead")||"{}");
  const {prom, nivel, resultados} = calcularTodo();
  const payload = {
    lead, seleccion,
    resultados,
    promedio_final: prom, nivel_final: nivel,
    timestamp: new Date().toISOString()
  };
  const blob = new Blob([JSON.stringify(payload,null,2)], {type:"application/json"});
  const url = URL.createObjectURL(blob);
  const a=$('dlJSON'); a.href=url; a.style.display="inline-block";
});

/* =======================
   Inicio
======================= */
$('btnIniciar').addEventListener('click',()=>{
  const lead = saveLead(); if(!lead) return;
  localStorage.setItem("last_lead", JSON.stringify(lead));
  seleccion = choose3(PROFILES);
  renderEvaluacion();
  $('evalWrap').style.display="block";
  window.scrollTo({top:document.getElementById('evalWrap').offsetTop, behavior:'smooth'});
});

</script>
</body>
</html>
