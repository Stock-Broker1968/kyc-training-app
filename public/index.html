<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <title>Módulo de Evaluación de Riesgos KYC/AML</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="color-scheme" content="light dark" />
  <style>
    :root{
      --bg1:#0f172a; --bg2:#111827; --card:#0b1220;
      --ink:#e5e7eb; --muted:#9ca3af; --primary:#10b981; --accent:#3b82f6;
      --warn:#f59e0b; --danger:#ef4444; --ok:#22c55e; --ring:#334155;
    }
    html,body{margin:0;font-family:system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,sans-serif;background:
      radial-gradient(1200px 600px at 10% -10%, #172554 0%, transparent 60%),
      radial-gradient(1200px 600px at 110% -10%, #0f766e 0%, transparent 60%),
      linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--ink);}
    .container{max-width:1100px;margin:auto;padding:24px;}
    .title{ text-align:center;margin:10px 0 22px }
    .title h1{font-size:clamp(22px,3vw,36px);margin:0}
    .grid{display:grid;gap:16px}
    @media(min-width:900px){.grid-2{grid-template-columns:1fr 1fr}}
    .card{
      background:linear-gradient(180deg,rgba(255,255,255,.04),rgba(255,255,255,.02));
      border:1px solid var(--ring); border-radius:16px; padding:16px 18px; box-shadow:0 8px 24px rgba(0,0,0,.2)
    }
    .section-title{display:flex;align-items:center;gap:8px;margin:6px 0 12px}
    .section-title h2{font-size:18px;margin:0}
    label{display:block;margin:10px 0 6px;color:var(--muted);font-size:14px}
    input[type=text], input[type=number], select, textarea{
      width:100%; background:#0b1220; color:var(--ink); border:1px solid #223; border-radius:10px;
      padding:10px 12px; outline:none; transition:.2s; box-sizing:border-box
    }
    input:focus, select:focus, textarea:focus{border-color:var(--accent); box-shadow:0 0 0 3px rgba(59,130,246,.25)}
    textarea{min-height:84px; resize:vertical}
    .row{display:grid;grid-template-columns:1fr 1fr; gap:12px}
    .row-3{display:grid;grid-template-columns:1fr 1fr 1fr; gap:12px}
    .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid var(--ring);font-size:12px;color:var(--muted)}
    .btns{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
    button,.btn{
      background:linear-gradient(135deg,#0ea5e9,#2563eb); color:#fff; border:none; padding:12px 16px;
      border-radius:12px; font-weight:700; cursor:pointer; box-shadow:0 10px 24px rgba(37,99,235,.25); transition:.15s
    }
    button:hover{transform:translateY(-1px)}
    .btn-ghost{background:transparent;border:1px solid var(--ring); color:var(--ink)}
    .btn-success{background:linear-gradient(135deg,#10b981,#059669)}
    .btn-warn{background:linear-gradient(135deg,#f59e0b,#d97706)}
    .btn-danger{background:linear-gradient(135deg,#ef4444,#b91c1c)}
    .scorebox{
      display:flex; align-items:center; gap:16px; background:#0b1220; border:1px solid var(--ring);
      border-radius:14px; padding:12px 14px; margin-top:10px
    }
    .meter{height:10px; flex:1; background:#111827; border-radius:8px; overflow:hidden; border:1px solid #223}
    .meter > i{display:block;height:100%; width:0%; background:linear-gradient(90deg,#22c55e,#f59e0b,#ef4444)}
    .badge{font-size:12px;padding:6px 10px;border-radius:10px;background:#111827;border:1px solid var(--ring)}
    /* Ficha policiaca */
    .ficha{
      display:grid; gap:14px; grid-template-columns:120px 1fr; align-items:start
    }
    .foto-wrap{
      aspect-ratio:3/4; background:#0b1220; border:2px solid #999; box-shadow:inset 0 0 0 6px #222;
      border-radius:6px; overflow:hidden; display:flex; align-items:center; justify-content:center; position:relative
    }
    .foto-wrap img{width:100%; height:100%; object-fit:cover}
    .marcas{position:absolute; inset:8px; border:1px dashed #888; pointer-events:none}
    .watermark{position:absolute; bottom:6px; right:6px; font-size:10px; color:#9ca3af; background:#0b1220a6; padding:2px 6px; border-radius:6px}
    .table{width:100%; border-collapse:collapse; overflow:hidden; border-radius:8px; border:1px solid var(--ring)}
    .table th,.table td{border-bottom:1px solid var(--ring); padding:8px 10px; text-align:left; font-size:14px}
    .table th{background:#0b1220; color:#cbd5e1}
    .right{text-align:right}
    .hide-print{ }
    @media print{
      .hide-print{display:none!important;}
      body{background:#fff; color:#000}
      .card{border:1px solid #777; box-shadow:none}
      .table th,.table td{border-color:#777}
    }
    .small{font-size:12px;color:var(--muted)}
  </style>
</head>
<body>
  <div class="container">
    <div class="title">
      <h1>Evaluación de Riesgos KYC/AML – Práctica</h1>
      <div class="small">Módulo demostrativo para sitio institucional y previsualización del curso (Hotmart)</div>
    </div>

    <!-- Ficha policiaca del sujeto -->
    <div class="card">
      <div class="section-title">
        <span class="pill">Identificación</span>
        <h2>Ficha del Sujeto (formato “ficha policiaca”)</h2>
      </div>
      <div class="grid grid-2">
        <div class="ficha">
          <div class="foto-wrap" id="fotoBox" aria-label="Fotografía del sujeto">
            <img id="fotoPreview" alt="Foto del sujeto (cargue una imagen)" />
            <div class="marcas"></div>
            <div class="watermark">ID Verif.</div>
          </div>
          <div>
            <label for="foto">Fotografía (frontal, sin lentes oscuros)</label>
            <input id="foto" type="file" accept="image/*" />
            <div class="small">Se incrusta en el reporte imprimible.</div>
          </div>
        </div>
        <div class="grid">
          <div class="row">
            <div>
              <label>Nombre(s)</label>
              <input id="nombre" type="text" placeholder="Nombre(s) del sujeto" />
            </div>
            <div>
              <label>Apellidos</label>
              <input id="apellidos" type="text" placeholder="Apellidos del sujeto" />
            </div>
          </div>
          <div class="row">
            <div>
              <label>Nacionalidad</label>
              <input id="nacionalidad" type="text" placeholder="p. ej., Mexicana" />
            </div>
            <div>
              <label>CURP/RFC/ID (opcional)</label>
              <input id="identif" type="text" placeholder="Clave o identificación" />
            </div>
          </div>
          <div>
            <label>Domicilio</label>
            <input id="domicilio" type="text" placeholder="Calle, No., Col., Municipio, Estado, CP" />
          </div>
          <div class="row">
            <div>
              <label>Ocupación/Actividad</label>
              <input id="actividad" type="text" placeholder="p. ej., Abogada corporativa" />
            </div>
            <div>
              <label>Fecha de evaluación</label>
              <input id="fechaEval" type="date" />
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Evaluación por factores -->
    <div class="grid grid-2">
      <!-- Actividad -->
      <div class="card" id="sec-actividad">
        <div class="section-title"><span class="pill">Factor 1</span><h2>Actividad</h2></div>
        <label>Nivel de riesgo por actividad (sector)</label>
        <select id="riesgoActividad">
          <option value="10">Muy bajo – empleo formal con nómina</option>
          <option value="25">Bajo – profesional independiente con facturación</option>
          <option value="50">Medio – comercio al menudeo / influencer / efectivo moderado</option>
          <option value="75">Alto – giros vulnerables/efectivo alto</option>
          <option value="90">Muy alto – giro altamente expuesto (ej. casinos, joyería, cripto informal)</option>
        </select>
        <label>Justificación (≥ 50 caracteres)</label>
        <textarea id="justActividad" placeholder="Describe por qué asignaste este nivel (fuentes, documentación, señales, etc.)"></textarea>
        <div class="scorebox"><span class="badge">Puntaje factor</span><div class="meter"><i id="mActividad"></i></div><strong id="sActividad">0</strong></div>
      </div>

      <!-- Transaccionalidad -->
      <div class="card" id="sec-transaccionalidad">
        <div class="section-title"><span class="pill">Factor 2</span><h2>Transaccionalidad</h2></div>
        <div class="row-3">
          <div>
            <label>Volumen mensual (MXN)</label>
            <input id="volumen" type="number" min="0" step="0.01" placeholder="ej. 50000" />
          </div>
          <div>
            <label>Frecuencia</label>
            <select id="frecuencia">
              <option value="10">Baja (≤ mensual)</option>
              <option value="30">Media (semanal)</option>
              <option value="60">Alta (diaria/varias al día)</option>
            </select>
          </div>
          <div>
            <label>Manejo de efectivo</label>
            <select id="efectivo">
              <option value="10">Bajo</option>
              <option value="40">Medio</option>
              <option value="75">Alto</option>
            </select>
          </div>
        </div>
        <label>Justificación (≥ 50 caracteres)</label>
        <textarea id="justTrans" placeholder="Explica señales (patrones, desvíos frente al perfil económico, etc.)"></textarea>
        <div class="scorebox"><span class="badge">Puntaje factor</span><div class="meter"><i id="mTrans"></i></div><strong id="sTrans">0</strong></div>
      </div>

      <!-- Instrumento Monetario -->
      <div class="card" id="sec-instrumento">
        <div class="section-title"><span class="pill">Factor 3</span><h2>Instrumento monetario</h2></div>
        <label>Principal instrumento</label>
        <select id="instrumento">
          <option value="15">Transferencia bancaria nacional</option>
          <option value="30">Transferencia internacional</option>
          <option value="55">Efectivo</option>
          <option value="70">Criptoactivos regulados</option>
          <option value="85">Criptoactivos P2P / no regulados</option>
          <option value="45">Cheques / giros / remesas</option>
        </select>
        <label>Justificación (≥ 50 caracteres)</label>
        <textarea id="justInstrumento" placeholder="Expón por qué el instrumento eleva o reduce el riesgo para este caso"></textarea>
        <div class="scorebox"><span class="badge">Puntaje factor</span><div class="meter"><i id="mInst"></i></div><strong id="sInst">0</strong></div>
      </div>

      <!-- Geografía -->
      <div class="card" id="sec-geo">
        <div class="section-title"><span class="pill">Factor 4</span><h2>Riesgo geográfico</h2></div>
        <div class="row">
          <div>
            <label>Ámbito</label>
            <select id="ambito">
              <option value="mx">México (Estado)</option>
              <option value="pais">País</option>
            </select>
          </div>
          <div>
            <label>Estado o País</label>
            <select id="geo" aria-label="Estado de la República o País"></select>
          </div>
        </div>
        <label>Justificación (≥ 50 caracteres)</label>
        <textarea id="justGeo" placeholder="Considera índices de criminalidad, corrupción, controles, listas, etc."></textarea>
        <div class="scorebox"><span class="badge">Puntaje factor</span><div class="meter"><i id="mGeo"></i></div><strong id="sGeo">0</strong></div>
      </div>

      <!-- PEP -->
      <div class="card" id="sec-pep">
        <div class="section-title"><span class="pill">Factor 5</span><h2>Relación con PEP</h2></div>
        <label>Exposición</label>
        <select id="pep">
          <option value="10">Sin relación PEP conocida</option>
          <option value="35">Familiar/Asociado de PEP de bajo nivel</option>
          <option value="60">Familiar/Asociado de PEP relevante</option>
          <option value="85">PEP directo (alto rango o internacional)</option>
        </select>
        <label>Justificación (≥ 50 caracteres)</label>
        <textarea id="justPEP" placeholder="Detalles de la relación, cargo, periodo, controles mitigantes, etc."></textarea>
        <div class="scorebox"><span class="badge">Puntaje factor</span><div class="meter"><i id="mPEP"></i></div><strong id="sPEP">0</strong></div>
      </div>

      <!-- Delitos / Incumplimientos -->
      <div class="card" id="sec-delitos">
        <div class="section-title"><span class="pill">Factor 6</span><h2>Delitos o incumplimientos fiscales</h2></div>
        <label>Historial</label>
        <select id="delitos">
          <option value="10">Sin antecedentes</option>
          <option value="45">Incumplimientos administrativos menores</option>
          <option value="70">Sanciones fiscales significativas</option>
          <option value="90">Antecedentes penales relevantes</option>
        </select>
        <label>Justificación (≥ 50 caracteres)</label>
        <textarea id="justDelitos" placeholder="Describe hallazgos, fuentes, fechas, situación jurídica, etc."></textarea>
        <div class="scorebox"><span class="badge">Puntaje factor</span><div class="meter"><i id="mDel"></i></div><strong id="sDel">0</strong></div>
      </div>
    </div>

    <!-- Resultado Global -->
    <div class="card">
      <div class="section-title"><span class="pill">Resultado</span><h2>Riesgo Global</h2></div>
      <div class="grid grid-2">
        <div>
          <table class="table" aria-label="Resumen de puntajes por factor">
            <thead><tr><th>Factor</th><th class="right">Puntaje (0-100)</th></tr></thead>
            <tbody>
              <tr><td>Actividad</td><td class="right" id="rAct">0</td></tr>
              <tr><td>Transaccionalidad</td><td class="right" id="rTra">0</td></tr>
              <tr><td>Instrumento monetario</td><td class="right" id="rIns">0</td></tr>
              <tr><td>Geografía</td><td class="right" id="rGeo">0</td></tr>
              <tr><td>Relación con PEP</td><td class="right" id="rPEP">0</td></tr>
              <tr><td>Delitos/Incumplimientos</td><td class="right" id="rDel">0</td></tr>
            </tbody>
            <tfoot>
              <tr><th>Puntaje global ponderado</th><th class="right" id="rGlobal">0</th></tr>
            </tfoot>
          </table>
          <div class="scorebox">
            <span class="badge" id="nivelBadge">Nivel —</span>
            <div class="meter"><i id="mGlobal"></i></div>
            <strong id="nivelTxt">—</strong>
          </div>
          <div class="small" style="margin-top:8px">
            Ponderaciones: Actividad 20%, Transaccionalidad 25%, Instrumento 15%, Geografía 15%, PEP 15%, Delitos 10%.
          </div>
        </div>
        <div>
          <label for="comentarios">Conclusión del analista (≥ 80 caracteres)</label>
          <textarea id="comentarios" placeholder="Sintetiza por qué el sujeto se clasifica en este nivel y qué mitigantes aplicar."></textarea>
          <div class="btns">
            <button class="btn-success hide-print" id="btnCalcular">Calcular riesgo</button>
            <button class="btn-warn hide-print" id="btnValidar">Validar justificaciones</button>
            <button class="btn hide-print" id="btnImprimir">Imprimir / PDF</button>
            <button class="btn-ghost hide-print" id="btnExport">Exportar JSON</button>
            <a class="btn-ghost hide-print" id="dlJson" download="evaluacion_kyc.json" style="display:none">Descargar JSON</a>
          </div>
        </div>
      </div>
    </div>

    <div class="small" style="text-align:center;margin:18px 0">
      Demo educativo de prácticas KYC/PLD. Este material es orientativo y debe adaptarse a la normativa y listas aplicables vigentes.
    </div>
  </div>

  <script>
    // ======== Tablas base de riesgo geográfico (editable) ========
    const RISK_TABLES = {
      mx: {
        "Aguascalientes": 35, "Baja California": 65, "Baja California Sur": 40, "Campeche": 35,
        "Chiapas": 55, "Chihuahua": 60, "Ciudad de México": 55, "Coahuila": 45, "Colima": 70,
        "Durango": 55, "Estado de México": 65, "Guanajuato": 65, "Guerrero": 75, "Hidalgo": 40,
        "Jalisco": 60, "Michoacán": 70, "Morelos": 55, "Nayarit": 45, "Nuevo León": 50,
        "Oaxaca": 50, "Puebla": 50, "Querétaro": 40, "Quintana Roo": 55, "San Luis Potosí": 45,
        "Sinaloa": 70, "Sonora": 55, "Tabasco": 55, "Tamaulipas": 70, "Tlaxcala": 35,
        "Veracruz": 60, "Yucatán": 30, "Zacatecas": 65
      },
      pais: {
        "México": 55, "Estados Unidos": 50, "Canadá": 35, "Alemania": 30, "Suiza": 40,
        "China": 60, "España": 35, "Reino Unido": 35, "Panamá": 65, "Islas Vírgenes": 80,
        "Bélgica": 30, "Brasil": 55, "Argentina": 50, "Guatemala": 60, "Colombia": 65, "Perú": 55
      }
    };

    // ======== Utilidades ========
    const $ = (id)=>document.getElementById(id);
    const byId = $;

    function setMeter(meterEl, value){
      const v = Math.max(0, Math.min(100, Number(value)||0));
      meterEl.style.width = v + "%";
    }
    function setScore(idLabel, idMeter, value){
      byId(idLabel).textContent = Math.round(value);
      setMeter(byId(idMeter), value);
    }
    function nivelFromScore(score){
      if(score < 30) return ["Bajo", "#22c55e"];
      if(score < 55) return ["Medio", "#f59e0b"];
      if(score < 75) return ["Alto", "#fb923c"];
      return ["Crítico", "#ef4444"];
    }
    function requireText(el, min=50){
      return (el.value||"").trim().length >= min;
    }
    function toast(msg){
      alert(msg);
    }

    // ======== Poblar combos de geografía ========
    function fillGeo(){
      const amb = byId("ambito").value;
      const sel = byId("geo");
      const data = Object.keys(RISK_TABLES[amb]).sort();
      sel.innerHTML = data.map(x=>`<option value="${x}">${x}</option>`).join("");
    }

    // ======== Cargar foto ========
    byId("foto").addEventListener("change", e=>{
      const f = e.target.files?.[0];
      if(!f) return;
      const reader = new FileReader();
      reader.onload = ev=>{ byId("fotoPreview").src = ev.target.result; };
      reader.readAsDataURL(f);
    });

    byId("ambito").addEventListener("change", fillGeo);
    fillGeo();

    // ======== Cálculo por factor ========
    function calcActividad(){
      const val = Number(byId("riesgoActividad").value);
      setScore("sActividad", "mActividad", val);
      byId("rAct").textContent = Math.round(val);
      return val;
    }
    function calcTrans(){
      // Fórmula simple ponderada: volumen normalizado (capar en 1M), + freq + efectivo
      const vol = Math.min(Number(byId("volumen").value||0), 1_000_000) / 1_000_000; // 0..1
      const volScore = vol * 100 * 0.50;           // 50% peso
      const freqScore = Number(byId("frecuencia").value) * 0.30; // 30% peso (input ya ~0..100)
      const efScore = Number(byId("efectivo").value) * 0.20;     // 20% peso
      const total = volScore + freqScore + efScore;
      setScore("sTrans", "mTrans", total);
      byId("rTra").textContent = Math.round(total);
      return total;
    }
    function calcInst(){
      const val = Number(byId("instrumento").value);
      setScore("sInst", "mInst", val);
      byId("rIns").textContent = Math.round(val);
      return val;
    }
    function calcGeo(){
      const amb = byId("ambito").value;
      const sel = byId("geo").value;
      const val = RISK_TABLES[amb][sel] ?? 50;
      setScore("sGeo", "mGeo", val);
      byId("rGeo").textContent = Math.round(val);
      return val;
    }
    function calcPEP(){
      const val = Number(byId("pep").value);
      setScore("sPEP", "mPEP", val);
      byId("rPEP").textContent = Math.round(val);
      return val;
    }
    function calcDelitos(){
      const val = Number(byId("delitos").value);
      setScore("sDel", "mDel", val);
      byId("rDel").textContent = Math.round(val);
      return val;
    }

    // ======== Global ========
    function calcGlobal(){
      const a = calcActividad();
      const t = calcTrans();
      const i = calcInst();
      const g = calcGeo();
      const p = calcPEP();
      const d = calcDelitos();
      const global = a*0.20 + t*0.25 + i*0.15 + g*0.15 + p*0.15 + d*0.10;
      const [nivel, color] = nivelFromScore(global);
      byId("rGlobal").textContent = Math.round(global);
      setMeter(byId("mGlobal"), global);
      const badge = byId("nivelBadge");
      badge.textContent = `Nivel ${nivel}`;
      badge.style.borderColor = color; badge.style.color = color;
      byId("nivelTxt").textContent = `${nivel}`;
      return global;
    }

    // ======== Validaciones ========
    function validateAll(show=true){
      const fields = [
        ["justActividad", 50, "Actividad"],
        ["justTrans", 50, "Transaccionalidad"],
        ["justInstrumento", 50, "Instrumento monetario"],
        ["justGeo", 50, "Geografía"],
        ["justPEP", 50, "PEP"],
        ["justDelitos", 50, "Delitos/Incumplimientos"],
      ];
      const fails = fields.filter(([id,min]) => !requireText(byId(id), min));
      if(show){
        if(fails.length){
          const list = fails.map(x => "• "+x[2]).join("\n");
          toast("Faltan justificaciones (≥ 50 caracteres) en:\n\n"+list);
        }else{
          toast("Justificaciones completas ✅");
        }
      }
      return fails.length === 0;
    }

    // ======== Exportación JSON ========
    function exportJSON(){
      const payload = {
        sujeto: {
          nombre: byId("nombre").value.trim(),
          apellidos: byId("apellidos").value.trim(),
          nacionalidad: byId("nacionalidad").value.trim(),
          identificacion: byId("identif").value.trim(),
          domicilio: byId("domicilio").value.trim(),
          actividad: byId("actividad").value.trim(),
          fechaEvaluacion: byId("fechaEval").value
        },
        factores: {
          actividad: {score: Number(byId("rAct").textContent), just: byId("justActividad").value},
          transaccionalidad: {score: Number(byId("rTra").textContent), just: byId("justTrans").value},
          instrumento: {score: Number(byId("rIns").textContent), just: byId("justInstrumento").value},
          geografia: {
            ambito: byId("ambito").value, zona: byId("geo").value,
            score: Number(byId("rGeo").textContent), just: byId("justGeo").value
          },
          pep: {score: Number(byId("rPEP").textContent), just: byId("justPEP").value},
          delitos: {score: Number(byId("rDel").textContent), just: byId("justDelitos").value}
        },
        resultado: {
          global: Number(byId("rGlobal").textContent),
          nivel: byId("nivelTxt").textContent,
          comentarios: byId("comentarios").value
        },
        version: "1.0.0"
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
      const url = URL.createObjectURL(blob);
      const a = byId("dlJson");
      a.href = url; a.style.display = "inline-block";
    }

    // ======== Botones ========
    byId("btnCalcular").addEventListener("click", ()=>{
      if(!validateAll(false)){
        toast("Sugerencia: completa todas las justificaciones para robustecer el expediente.");
      }
      const g = calcGlobal();
      toast(`Puntaje global: ${Math.round(g)} – Nivel ${byId("nivelTxt").textContent}`);
    });
    byId("btnValidar").addEventListener("click", ()=>validateAll(true));
    byId("btnImprimir").addEventListener("click", ()=>{
      calcGlobal();
      window.print();
    });
    byId("btnExport").addEventListener("click", ()=>{
      calcGlobal();
      exportJSON();
    });

    // Cálculo inicial
    calcGlobal();
  </script>
</body>
</html>

